{% extends "_includes/page.html" %}

{% from '_includes/macros.html' import project_lead %}

{% set current_project = project.id %}

{% block title %}{{ project.name }}{% endblock %}

{% block page %}
  {{ project_lead(project, 'gantt-chart') }}

  {% if chart %}
    <table class="table table-sm gantt-chart m-b">
      {% for block in chart.blocks %}
        <tr>
          <th><a href="{{ url_for('.view_task', task_id=block.task.id) }}">{{ block.task.name }}</a></th>
          {% for i in range((block.start - chart.start).days) %}
            <td></td>
          {% endfor %}

          <td class="bg-inverse" title="{{ block.task.name }}" style="background: hsl({{ ((loop.index - 1) / chart.blocks | length) * 360 }}, 50%, 50%)" colspan="{{ (block.end - block.start).days }}">
            <a href="{{ url_for('.view_task', task_id=block.task.id) }}">{{ block.task.name }}</a
          </td>

          {% for i in range((chart.end - block.end).days) %}
            <td></td>
          {% endfor %}
        </tr>
      {% endfor %}
    </table>

    <a class="btn btn-primary pull-right m-t" href="{{ url_for('.new_task', project_id=project.id) }}" role="button"><span class="fa fa-plus m-r"></span>New task</a>
    <div class="clearfix"></div>
  {% else %}
    <p class="lead text-center">This project hasn't got any tasks.</p>
    <p class="text-center">Click the button below to create one.</p>
    <p class="text-center">
      <a class="btn btn-primary" href="{{ url_for('.new_task', project_id=project.id) }}" role="button"><span class="fa fa-plus m-r"></span>New task</a>
    </p>
  {% endif %}
{% endblock %}
